<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoomable Interactive World Map</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f4f4f9;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    #map-container {
      background-color: #e0f7fa;
      /* Ocean color */
      border: 2px solid #ccc;
      border-radius: 8px;
      overflow: hidden;
      position: relative;
    }

    .ocean {
      fill: #0772ca;
      stroke: #044691;
      stroke-width: 1.5px;
    }

    .country {
      fill: #7cb342;
      /* Land color */
      stroke: #568029;
      stroke-width: 1px;
      vector-effect: non-scaling-stroke;
      transition: fill 0.2s;
      cursor: pointer;
    }

    .country:hover {
      fill: #558b2f;
      /* Highlight on hover */
    }

    .country.selected {
      fill: #ff9800;
    }

    /* Tooltip styling */
    .tooltip {
      position: absolute;
      width: 2000px;
      text-align: center;
      padding: 8px 12px;
      font-size: 18px;
      font-weight: bold;
      background: rgba(3, 168, 30, 0.8);
      color: #fff;
      border-radius: 4px;
      pointer-events: none;
      opacity: 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      z-index: 10;
    }
  </style>
</head>

<body>

  <div id="map-container">
    <div class="tooltip" id="tooltip"></div>
  </div>

  <script>
    // Set dimensions for the SVG container
    const width = 2000;
    const height = 1500;

    // Create the SVG element
    const svg = d3.select("#map-container")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // Create a group for the map (required for semantic zooming)
    const g = svg.append("g");

    // Define the map projection (Natural Earth is visually pleasing for world maps)
    const projection = d3.geoNaturalEarth1()
      .scale(460)
      .translate([width / 2, height / 2]);

    // Define the path generator
    const path = d3.geoPath().projection(projection);

    // Select the tooltip
    const tooltip = d3.select("#tooltip");

    // Set up the Zoom behavior
    const zoom = d3.zoom()
      .scaleExtent([1, 148]) // Zoom limits: 1x to 8x
      .on("zoom", (event) => {
        g.attr("transform", event.transform);
      });

    // Apply the zoom behavior to the SVG
    svg.call(zoom);
    // Add a white sphere with a black border.

    // Optional: Hide tooltip when clicking on the background (ocean)
    svg.on("click", (event) => {
      if (event.target.tagName !== "path") {
        tooltip.style("opacity", 0);
      }
    });

    // Draw the background sphere (ocean and outline)
    g.append("path")
      .datum({ type: "Sphere" })
      .attr("class", "ocean")
      .attr("d", path);
    // Fetch the GeoJSON data for the world
    // src: https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson
    // const geojsonUrl = "./world.geojson";
    // const geojsonUrl = "https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_50m_admin_0_countries.geojson";
    const geojsonUrl = "./worldDetailed.geojson";

    d3.json(geojsonUrl).then(data => {
      // Draw the countries
      g.selectAll(".country")
        .data(data.features)
        .join("path")
        .attr("d", path)
        .attr("class", "country")
        // Handle the click event to show the popup
        .on("click", function (event, d) {
          // Prevent the SVG background click from triggering
          event.stopPropagation();

          d3.select(this).classed("selected", true);
          const countryName = d.properties.NAME || d.properties.ADMIN || d.properties.name;;

          // Show and position the tooltip
          tooltip.style("opacity", 1)
            .html(countryName);
        })
        // Optional: Hide tooltip when the mouse leaves the country (if preferred over clicking elsewhere)
        .on("mouseleave", function () {
          // tooltip.style("opacity", 0);
        });
    }).catch(error => {
      console.error("Error loading the map data: ", error);
    });
  </script>
</body>

</html>